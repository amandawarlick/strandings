---
title: ''
output:
  pdf_document: default
  pdf: default
---

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(ggmap)
library(data.table)
library(cowplot)
library(stats)
library(captioner)
library(knitr)
library(reshape2)
library(stringr)
library(magrittr)
library(scales)
#setwd("~/Documents/R/Strandings")

# Data Load 
###############################################################################
# Data is pre-cleaned
pinnipeds_data <- read.csv("pinnipeds_data.csv", header = TRUE, na.strings = "", stringsAsFactors = FALSE)

# Set Up Factors
pinnipeds_data$Age.Class <- factor(pinnipeds_data$Age.Class, 
                                   levels = c("Pup", "Yearling", "Subadult", "Adult", "Unid"))

pinnipeds_data$Month.of.Observation <- factor(pinnipeds_data$Month.of.Observation, 
                      levels = c('JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'))

```

#### Questions

##Changes in total annual strandings per year  

- Are total annual combined strandings or of each species increasing or decreasing over time?
```{r}
### Are total annual combined strandings or of each species increasing over time?  

##All strandings, combined species
data_by_year <- pinnipeds_data %>% 
  group_by(Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number)) 

# <--- Statistically significant change in all stranding cases combined over time 
timeseries_all_model <- glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = data_by_year)
summary(lm(cnt ~ Year.of.Observation, data_by_year))
summary(timeseries_all_model)
autoplot(timeseries_all_model)
#slope of line =  exp(0.050462) = 1.05

#chow test?

##All strandings, separate species
##HELP: GLM poisson slopes are too similar to make sense, while lm slopes are closer to what I would expect based on the different volume of strandings per species

all_sp <- pinnipeds_data %>%
  group_by(Year.of.Observation, Pinniped.Common.Name) %>%
  summarize(cnt = n_distinct(National.Database.Number))


summary(lm(cnt ~ Year.of.Observation, data = all_sp %>% filter(Pinniped.Common.Name == 'Harbor seal'))) #y = 16x
summary(glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = all_sp %>% filter(Pinniped.Common.Name == 'Harbor seal')))
#                       Estimate Std. Error z value Pr(>|z|)    
# (Intercept)         -1.084e+02  2.994e+00  -36.19   <2e-16 ***
# Year.of.Observation  5.694e-02  1.493e-03   38.14   <2e-16 ***
# y = 1.1x

summary(lm(cnt ~ Year.of.Observation, data = all_sp %>% filter(Pinniped.Common.Name == 'California sea lion'))) # y = 7.9x
summary(glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = all_sp %>% filter(Pinniped.Common.Name == 'California sea lion')))
#                       Estimate Std. Error z value Pr(>|z|)    
# (Intercept)         -1.732e+02  5.728e+00  -30.23   <2e-16 ***
# Year.of.Observation  8.867e-02  2.854e-03   31.07   <2e-16 ***
# y = 1.1x

summary(glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = all_sp %>% filter(Pinniped.Common.Name == 'Northern fur seal')))
#                     Estimate Std. Error z value Pr(>|z|)    
# (Intercept)         -90.9306    25.0734  -3.627 0.000287 ***
# Year.of.Observation   0.0462     0.0125   3.695 0.000220 ***
# y = 1.0x

summary(glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = all_sp %>% filter(Pinniped.Common.Name == 'Northern elephant seal')))
#                       Estimate Std. Error z value Pr(>|z|)    
# (Intercept)         -39.277728  12.590964  -3.120  0.00181 ** 
# Year.of.Observation   0.020988   0.006285   3.339  0.00084 ***
# y = 1.0x

summary(lm(cnt ~ Year.of.Observation, data = all_sp %>% filter(Pinniped.Common.Name == 'Steller sea lion'))) # y = 3.9x
summary(glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = all_sp %>% filter(Pinniped.Common.Name == 'Steller sea lion')))
#                       Estimate Std. Error z value Pr(>|z|)    
# (Intercept)         -2.595e+02  1.083e+01  -23.97   <2e-16 ***
# Year.of.Observation  1.312e-01  5.389e-03   24.34   <2e-16 ***
# y = 1.1x

summary(lm(cnt ~ Year.of.Observation, data = all_sp %>% filter(Pinniped.Common.Name == 'Guadalupe fur seal'))) # not sig
summary(glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = all_sp %>% filter(Pinniped.Common.Name == 'Guadalupe fur seal')))
#                        Estimate Std. Error z value Pr(>|z|)    
# (Intercept)         -219.76725   55.94694  -3.928 8.56e-05 ***
# Year.of.Observation    0.11057    0.02782   3.975 7.05e-05 *** 
# y = 1.1x


```

- Are total annual *number* of HI cases increasing over time?
```{r}
# Are total annual human interaction cases increasing/decreasing over time for:

# (a) combined species 
HI_by_year <- pinnipeds_data %>%
  filter(Findings.of.Human.Interaction == 'Y') %>%
  group_by(Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number)) 

# <--- Yes, significant increase of all HI cases, 
timeseries_HI_model <- glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = HI_by_year)
summary(timeseries_HI_model)
#regression equation: y = exp(0.1089)x = 1.11x

# (b) certain HI types
HI_type_by_year <- pinnipeds_data %>%
  filter(Findings.of.Human.Interaction == 'Y' & Interaction.Type != 'NA') %>%
  group_by(Year.of.Observation, Interaction.Type) %>%
  summarize(cnt = n_distinct(National.Database.Number)) 


summary(glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = HI_type_by_year %>% filter(Interaction.Type == 'Gunshot')))
#                       Estimate Std. Error z value Pr(>|z|)    
# (Intercept)         -1.717e+02  1.258e+01  -13.64   <2e-16 ***
# Year.of.Observation  8.713e-02  6.269e-03   13.90   <2e-16 ***
# y = 1.1x

summary(glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = HI_type_by_year %>% filter(Interaction.Type == 'Fisheries')))
#                       Estimate Std. Error z value Pr(>|z|)    
# (Intercept)         -1.763e+02  1.689e+01  -10.44   <2e-16 ***
# Year.of.Observation  8.918e-02  8.416e-03   10.60   <2e-16 ***
# y = 1.1x

summary(glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = HI_type_by_year %>% filter(Interaction.Type == 'Boat')))
#                       Estimate Std. Error z value Pr(>|z|)    
# (Intercept)         -189.92718   48.36681  -3.927 8.61e-05 ***
# Year.of.Observation    0.09530    0.02407   3.959 7.53e-05 ***
# y = 1.1x

# (c) for individual species?  
HI_sp <- pinnipeds_data %>%
  filter(Findings.of.Human.Interaction == 'Y' & Interaction.Type != 'NA') %>%
  group_by(Year.of.Observation, Pinniped.Common.Name) %>%
  summarize(cnt = n_distinct(National.Database.Number))


summary(glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = HI_sp %>% filter(Pinniped.Common.Name == 'Guadalupe fur seal')))
#                      Estimate Std. Error z value Pr(>|z|)  
# (Intercept)         -722.8385   286.6015  -2.522   0.0117 *
# Year.of.Observation    0.3602     0.1426   2.527   0.0115 *
# y = 1.4x

summary(glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = HI_sp %>% filter(Pinniped.Common.Name == 'Harbor seal')))
#                       Estimate Std. Error z value Pr(>|z|)    
# (Intercept)         -2.248e+02  1.143e+01  -19.67   <2e-16 ***
# Year.of.Observation  1.138e-01  5.692e-03   19.99   <2e-16 ***
# y = 1.1x

summary(glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = HI_sp %>% filter(Pinniped.Common.Name == 'California sea lion')))
#                       Estimate Std. Error z value Pr(>|z|)    
# (Intercept)         -214.04947   16.48563  -12.98   <2e-16 ***
# Year.of.Observation    0.10810    0.00821   13.17   <2e-16 ***
# y = 1.1x

summary(glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = HI_sp %>% filter(Pinniped.Common.Name == 'Steller sea lion')))
#                       Estimate Std. Error z value Pr(>|z|)    
# (Intercept)         -201.64410   27.58271  -7.311 2.66e-13 ***
# Year.of.Observation    0.10154    0.01373   7.396 1.40e-13 ***
# y = 1.1x

summary(glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = HI_sp %>% filter(Pinniped.Common.Name == 'Northern fur seal'))) #Not sig

summary(glm(cnt ~ Year.of.Observation, family = poisson(link = log), data = HI_sp %>% filter(Pinniped.Common.Name == 'Northern elephant seal'))) #Not sig

```

- Is the *prevalence* of human interaction cases increasing or decreasing over time for certain species? Help: Poisson isn't for proportions, so use lm() or prop.trend.test()?
```{r}

# Is the prevalence of human interaction cases increasing or decreasing over time for certain species? 

#All HI cases, species combined
HI_prev <- pinnipeds_data %>%
  group_by(Year.of.Observation, Findings.of.Human.Interaction) %>%
  summarize(cnt = n_distinct(National.Database.Number)) %>%
  dcast(Year.of.Observation ~ Findings.of.Human.Interaction, value.var = 'cnt')
HI_prev[is.na(HI_prev)] <- 0
HI_prev <- HI_prev %>%
    transform(Prop.HI = round(Y/(Y+N+CBD), 2)) %>%
  select(-c(CBD, N, Y))

# <-- Shows increasing over time: y = 0.005x
HIprev_model_lm <- lm(Prop.HI ~ Year.of.Observation, data = HI_prev)
summary(HIprev_model_lm)

## Try with prop.trend.test
# prop.trend.table <- HI_by_year %>%
#   merge(data_by_year, by = "Year.of.Observation") %>%
#   melt(id.vars = "Year.of.Observation") %>%
#   dcast(variable ~ Year.of.Observation)
# 
# prop.yes <- prop.trend.table[1, 2:28]
# tot <- prop.trend.table[2, 2:28]
# prop.trend.test(prop.yes, tot, score = length(prop.yes))

#All HI cases, separate species
HI_prev_species <- pinnipeds_data %>%
  filter(Pinniped.Common.Name != 'Unidentified') %>% 
  group_by(Pinniped.Common.Name, Year.of.Observation, Findings.of.Human.Interaction) %>%
  summarize(cnt = n_distinct(National.Database.Number)) %>%
  dcast(Pinniped.Common.Name + Year.of.Observation ~ Findings.of.Human.Interaction, value.var = 'cnt')
HI_prev_species[is.na(HI_prev_species)] <- 0
HI_prev_species <- HI_prev_species %>%
  transform(Prop.HI = round(Y/(Y+N+CBD), 2)) %>%
  select(-c(CBD, N, Y))

summary(lm(Prop.HI ~ Year.of.Observation, data = HI_prev_species %>% filter(Pinniped.Common.Name == 'Harbor seal')))
#                       Estimate Std. Error t value Pr(>|t|)    
# (Intercept)         -9.1574074  1.7979176  -5.093 2.93e-05 ***
# Year.of.Observation  0.0046154  0.0008981   5.139 2.60e-05 ***
# Multiple R-squared:  0.5137,	Adjusted R-squared:  0.4943 
# F-statistic: 26.41 on 1 and 25 DF,  p-value: 2.6e-05

summary(lm(Prop.HI ~ Year.of.Observation, data = HI_prev_species %>% filter(Pinniped.Common.Name == 'California sea lion')))
#                      Estimate Std. Error t value Pr(>|t|)  
# (Intercept)         -9.801481   4.322210  -2.268   0.0322 *
# Year.of.Observation  0.004969   0.002159   2.302   0.0300 *
# Multiple R-squared:  0.1749,	Adjusted R-squared:  0.1419 
# F-statistic: 5.298 on 1 and 25 DF,  p-value: 0.02995

summary(lm(Prop.HI ~ Year.of.Observation, data = HI_prev_species %>% filter(Pinniped.Common.Name == 'Northern elephant seal')))
#                      Estimate Std. Error t value Pr(>|t|)  
# (Intercept)         -9.115556   4.454919  -2.046   0.0514 .
# Year.of.Observation  0.004585   0.002225   2.060   0.0499 *
# Multiple R-squared:  0.1452,	Adjusted R-squared:  0.111 
# F-statistic: 4.245 on 1 and 25 DF,  p-value: 0.04991

summary(lm(Prop.HI ~ Year.of.Observation, data = HI_prev_species %>% filter(Pinniped.Common.Name == 'Guadalupe fur seal'))) #Not sig
summary(lm(Prop.HI ~ Year.of.Observation, data = HI_prev_species %>% filter(Pinniped.Common.Name == 'Northern fur seal'))) #Not sig
summary(lm(Prop.HI ~ Year.of.Observation, data = HI_prev_species %>% filter(Pinniped.Common.Name == 'Steller sea lion'))) #Not sig

#Separate HI types, combined species
numberperyear <- pinnipeds_data %>% 
  group_by(Year.of.Observation) %>%
  summarize(yr.cnt = n_distinct(National.Database.Number))

HIprev_type <- pinnipeds_data %>%
  filter(Findings.of.Human.Interaction == 'Y') %>%
  group_by(Interaction.Type, Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number)) %>%
  dcast(Year.of.Observation ~ Interaction.Type, value.var = 'cnt') 
HIprev_type[is.na(HIprev_type)] <- 0
HIprev_type <- HIprev_type %>%
  merge(numberperyear, by = c('Year.of.Observation')) %>%
  transform(Boat = (Boat/yr.cnt), 
            Fisheries = (Fisheries/yr.cnt),
            Gunshot = (Gunshot/yr.cnt),
            Other = (Other/yr.cnt)) %>%
  select(Year.of.Observation, Boat, Gunshot, Fisheries, Other) %>%
  melt(id.vars = c("Year.of.Observation")) 

# <-- All types increasing over time, with gunshot wounds increasing at the highest rate, boat at the lowest rate

summary(lm(value ~ Year.of.Observation, data = HIprev_type %>% filter(variable == 'Gunshot')))
#                       Estimate Std. Error t value Pr(>|t|)  
# (Intercept)         -2.3034144  1.1298514  -2.039   0.0522 .
# Year.of.Observation  0.0011687  0.0005644   2.071   0.0489 *
# Multiple R-squared:  0.1464,	Adjusted R-squared:  0.1123 
# F-statistic: 4.288 on 1 and 25 DF,  p-value: 0.04885

summary(lm(value ~ Year.of.Observation, data = HIprev_type %>% filter(variable == 'Fisheries')))
#                      Estimate Std. Error t value Pr(>|t|)   
# (Intercept)         -1.3548977  0.4486126  -3.020  0.00575 **
# Year.of.Observation  0.0006864  0.0002241   3.063  0.00519 **
# Multiple R-squared:  0.2729,	Adjusted R-squared:  0.2438 
# F-statistic: 9.383 on 1 and 25 DF,  p-value: 0.005186

summary(lm(value ~ Year.of.Observation, data = HIprev_type %>% filter(variable == 'Boat')))
#                       Estimate Std. Error t value Pr(>|t|)    
# (Intercept)         -7.940e-01  1.448e-01  -5.483 1.07e-05 ***
# Year.of.Observation  3.986e-04  7.233e-05   5.511 1.00e-05 ***
# Multiple R-squared:  0.5485,	Adjusted R-squared:  0.5304 
# F-statistic: 30.37 on 1 and 25 DF,  p-value: 1.001e-05

#Separate HI types, separate species
numberperyearperspecies <- pinnipeds_data %>% 
  group_by(Year.of.Observation, Pinniped.Common.Name) %>%
  summarize(yr.cnt = n_distinct(National.Database.Number))

HIprev_type_species <- pinnipeds_data %>%
  filter(Findings.of.Human.Interaction == 'Y' & Pinniped.Common.Name != "Unidentified") %>%
  group_by(Interaction.Type, Year.of.Observation, Pinniped.Common.Name) %>%
  summarize(cnt = n_distinct(National.Database.Number)) %>%
  dcast(Year.of.Observation + Pinniped.Common.Name ~ Interaction.Type, value.var = 'cnt') 
HIprev_type_species[is.na(HIprev_type_species)] <- 0
HIprev_type_species <- HIprev_type_species %>%
  merge(numberperyearperspecies, by = c('Year.of.Observation', 'Pinniped.Common.Name')) %>%
  transform(Boat = (Boat/yr.cnt), 
            Fisheries = (Fisheries/yr.cnt),
            Gunshot = (Gunshot/yr.cnt),
            Other = (Other/yr.cnt)) %>%
  select(Year.of.Observation, Pinniped.Common.Name, Boat, Gunshot, Fisheries, Other) %>%
  melt(id.vars = c("Year.of.Observation", "Pinniped.Common.Name")) 

# <--- NFS fisheries, GFS fisheries increasing, HS gunshot decreasing
# HItype_model_sp_lm <- lm(value ~ Pinniped.Common.Name*variable, data = HIprev_type_species)
# summary(HItype_model_sp_lm)

summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'California sea lion' & variable == 'Boat')))
summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'California sea lion' & variable == 'Fisheries'))) #Not sig
summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'California sea lion' & variable == 'Gunshot'))) #Not sig

summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'Harbor seal' & variable == 'Boat')))
summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'Harbor seal' & variable == 'Fisheries')))
summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'Harbor seal' & variable == 'Gunshot'))) #Not sig

summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'Guadalupe fur seal' & variable == 'Boat'))) #Not sig
summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'Guadalupe fur seal' & variable == 'Fisheries'))) #Not sig
summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'Guadalupe fur seal' & variable == 'Gunshot'))) #Not sig

summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'Northern fur seal' & variable == 'Boat'))) #Not sig
summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'Northern fur seal' & variable == 'Fisheries'))) #Not sig
summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'Northern fur seal' & variable == 'Gunshot'))) #Not sig

summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'Northern elephant seal' & variable == 'Boat'))) #Not sig
summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'Northern elephant seal' & variable == 'Fisheries'))) #Not sig
summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'Northern elephant seal' & variable == 'Gunshot'))) #Not sig

summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'Steller sea lion' & variable == 'Boat'))) #Not sig
summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'Steller sea lion' & variable == 'Fisheries'))) #Not sig
summary(lm(value ~ Year.of.Observation, data = HIprev_type_species %>% filter(Pinniped.Common.Name == 'Steller sea lion' & variable == 'Gunshot'))) #Not sig
```

## Seasonality  

- Is there a seasonal peak in strandings and HI cases for certain species? 
- Help confirm multivariate coefficient interpretation.
```{r}
# Is there a seasonal peak evident across all data? 
monthly_all <- pinnipeds_data %>%
  filter(Observation.Status == 'ALIVE' | Observation.Status == 'FRESH DEAD') %>%
  group_by(Month.of.Observation, Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number))

# <-- Yes, May through October is different from the rest of the year
kruskal.test(monthly_all)
kruskalmc(monthly_all$cnt ~ monthly_all$Month.of.Observation)
posthoc.kruskal.nemenyi.test(cnt ~ Month.of.Observation, data = monthly_all, dist = "Chisquare")
  
# Is there a seasonal peak in stranding cases for certain species? 
monthly_species <- pinnipeds_data %>%
  filter(Observation.Status == 'ALIVE' | Observation.Status == 'FRESH DEAD') %>%
  filter(Pinniped.Common.Name != 'Unidentified') %>%
  group_by(Month.of.Observation, Pinniped.Common.Name, Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number))

# <--- Help - check interpretation of multi-factor regressions coefficients?
# <--- CSL low in Feb, high in May and Aug-Nov; GFS high June, HS low in Nov, high Apr - Sep; NES high in Apr, low Sep-Nov; Stellers lower Sep-Oct; NFS high in May
# monthly_all_model_sp <- glm(cnt ~ Month.of.Observation*Pinniped.Common.Name, family = poisson(link = log), data = monthly_species)
# summary(monthly_all_model_sp)

summary(glm(cnt ~ Month.of.Observation, family = poisson(link = log), data = monthly_species %>% filter(Pinniped.Common.Name == 'Harbor seal'))) #Apr - Oct
summary(glm(cnt ~ Month.of.Observation, family = poisson(link = log), data = monthly_species %>% filter(Pinniped.Common.Name == 'Northern fur seal'))) #Nov
summary(glm(cnt ~ Month.of.Observation, family = poisson(link = log), data = monthly_species %>% filter(Pinniped.Common.Name == 'Guadalupe fur seal'))) #June
summary(glm(cnt ~ Month.of.Observation, family = poisson(link = log), data = monthly_species %>% filter(Pinniped.Common.Name == 'Northern elephant seal'))) #June
summary(glm(cnt ~ Month.of.Observation, family = poisson(link = log), data = monthly_species %>% filter(Pinniped.Common.Name == 'California sea lion'))) #May, Aug-Nov
summary(glm(cnt ~ Month.of.Observation, family = poisson(link = log), data = monthly_species %>% filter(Pinniped.Common.Name == 'Steller sea lion'))) #Mar

# Seasonal peak for human interactions cases?  

monthly_species_HI <- pinnipeds_data %>%
  filter(Observation.Status == 'ALIVE' | Observation.Status == 'FRESH DEAD') %>%
  filter(Pinniped.Common.Name != 'Unidentified') %>%
  filter(Findings.of.Human.Interaction == 'Y') %>%
  group_by(Month.of.Observation, Pinniped.Common.Name, Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number)) 

# <--- same as above, if correct, HS only one showing seasonal peak for HI cases June - Oct, by exp(2.1) = ~8/month
monthly_HI_model_sp <- glm(cnt ~ Month.of.Observation*Pinniped.Common.Name, family = poisson(link = log), data = monthly_species_HI)
summary(monthly_HI_model_sp)

```


## Spatial Patterns  

- Is there a statistical difference in strandings and HI across counties? (WA)
```{r}
# Is there a statistical difference in strandings/HI across counties? 
# Ideally, would show which are different from the "baseline" of overall stranding cases in those counties, but struggled with this.

#All strandings, WA
allWA_bycounty <- pinnipeds_data %>% 
  filter(County != 'NA' & County != 'Unknown' & State == 'WA') %>%
  transform(County = factor(County)) %>%
  group_by(County, Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number))

# <--- Overall, yes, county is a significant predictor. Pairwise shows San Juan dif from Mason, Pacific, Clark, Cowlitz, Thurston
kruskal.test(allWA_bycounty)
#kruskalmc(allWA_bycounty$cnt ~ allWA_bycounty$County) 
posthoc.kruskal.nemenyi.test(cnt ~ County, allWA_bycounty, dist = "Chisquare")

#HI strandings, WA
WAHI_bycounty <- pinnipeds_data %>% 
  filter(County != 'NA' & State == 'WA' & 
           Findings.of.Human.Interaction == 'Y' & 
           Interaction.Type != 'NA') %>% 
  transform(County = factor(County)) %>%
  group_by(County, Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number))

# <--- County is a significant predictor overall. K-W shows higher in Pacific
kruskal.test(WAHI_bycounty)
kruskalmc(WAHI_bycounty$cnt ~ WAHI_bycounty$County)
posthoc.kruskal.nemenyi.test(cnt ~ County, WAHI_bycounty, dist = "Chisquare")


```

- Is there a statistical difference in strandings and HI across counties? (OR)
```{r}

#All strandings, OR
allOR_bycounty <- pinnipeds_data %>% 
  filter(County != 'NA' & County != 'Unknown' & State == 'OR') %>% 
  transform(County = factor(County)) %>%
  group_by(County, Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number))

# <--- K-W show strandings higher in Lincoln
kruskal.test(allOR_bycounty)
posthoc.kruskal.nemenyi.test(cnt ~ County, allOR_bycounty, dist = "Chisquare")

#HI strandings, OR
ORHI_bycounty <- pinnipeds_data %>% 
  filter(County != 'NA' & State == 'OR' & 
           Findings.of.Human.Interaction == 'Y' & 
           Interaction.Type != 'NA') %>% 
  transform(County = factor(County)) %>%
  group_by(County, Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number)) 


# <--- K-W shows Clatsop, Lincoln
kruskal.test(ORHI_bycounty)
posthoc.kruskal.nemenyi.test(cnt ~ County, ORHI_bycounty, dist = "Tukey")


```

- Are specific types of HI cases increasing or decreasing in certain counties?
```{r}
# Are gunshot, entanglements, or boat collisions increasing in certain counties? 

#Washington
WAHI_type_yr <- pinnipeds_data %>% 
  filter(County != 'NA' & State == 'WA' & 
           Findings.of.Human.Interaction == 'Y' & 
           Interaction.Type != 'NA') %>% 
  transform(County = factor(County)) %>%
  group_by(County, Year.of.Observation, Interaction.Type) %>%
  summarize(cnt = n_distinct(National.Database.Number))

# <--- Shows increasing in Grays, Pacific, Pierce, CLallam, Whatcom?
WAHI_yr_model <- glm(cnt ~ County + Year.of.Observation, family = poisson(link = log), WAHI_type_yr)
summary(WAHI_yr_model)
# (Intercept)         -6.830e+01  1.018e+01  -6.707 1.98e-11 ***
# CountyGrays Harbor   7.045e-01  1.669e-01   4.221 2.43e-05 *** y = 2.02x
# CountyPacific        7.491e-01  1.594e-01   4.699 2.61e-06 *** y = 2.1x
# CountyPierce         8.177e-01  1.552e-01   5.270 1.36e-07 *** y = 2.3x
# Year.of.Observation  3.431e-02  5.071e-03   6.766 1.32e-11 *** y = 1.0x

# <--- Shows only "other" increasing in Pierce?
WAHI_type_yr_model <- glm(cnt ~ County*Interaction.Type, family = poisson(link = log), WAHI_type_yr)
summary(WAHI_type_yr_model)

# Oregon
ORHI_type_bycounty <- pinnipeds_data %>% 
  filter(County != 'NA' & State == 'OR' & 
           Findings.of.Human.Interaction == 'Y' & 
           Interaction.Type != 'NA') %>% 
  transform(County = factor(County)) %>%
  group_by(County, Interaction.Type, Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number)) 

#Increasing just in Clallam and Clatsop, not changing either way anywhere else
ORcounty_HI_model <- glm(cnt ~ County + Year.of.Observation, family = poisson(link = log), ORHI_type_bycounty)
summary(ORcounty_HI_model)

# CountyClatsop         1.420888   0.582208   2.441   0.0147 *    y = 4.1x
# Year.of.Observation   0.041630   0.007356   5.660 1.52e-08 ***  y = 1.0x

# <--- Shows none are significant
ORHI_type_yr_model <- glm(cnt ~ County*Interaction.Type, family = poisson(link = log), ORHI_type_bycounty)
summary(ORHI_type_yr_model)

```


## Categorical/Basic Species, Age and Sex Classes  

- Is there a difference in species of strandings and HI cases? 

```{r}
#all strandings
species <- pinnipeds_data %>%
  group_by(Pinniped.Common.Name) %>%
  summarize(cnt = n_distinct(National.Database.Number))

# <--- Yes, species are different
kruskal.test(species)

#HI cases
species_HI <- pinnipeds_data %>%
  filter(Findings.of.Human.Interaction == 'Y') %>%
  group_by(Pinniped.Common.Name) %>%
  summarize(cnt = n_distinct(National.Database.Number))

# <--- Yes, species are different
kruskal.test(species_HI)

```

- Is there a difference in sex of strandings and HI cases?
```{r}

# Is there a difference in sex of strandings/HI cases?  
 
#All strandings
Sex_all_yr <- pinnipeds_data %>%
  filter(Sex == 'Male' | Sex == 'Female') %>%
  group_by(Sex, Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number)) 

# <--- Yes, males different (higher) from females
kruskal.test(Sex_all_yr)
kruskalmc(Sex_all_yr$cnt ~ Sex_all_yr$Sex)

#HI strandings
Sex_HI_yr <- pinnipeds_data %>%
  filter(Sex == 'Male' | Sex == 'Female') %>%
  filter(Findings.of.Human.Interaction == 'Y' & Interaction.Type != 'NA') %>%
  group_by(Sex, Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number)) 

# <-- Yes, males different (higher) from females
kruskal.test(Sex_HI_yr)
kruskalmc(Sex_HI_yr$cnt ~ Sex_HI_yr$Sex)
# sex_HI_model <- glm(cnt ~ Sex, family = poisson(link = log), Sex_HI_yr)
# summary(sex_HI_model)

```

- Is there a difference in sex of strandings across months of the year?
```{r}
# Is there a difference in sex of strandings in different seasons?

#All strandings
Sex_all_mo <- pinnipeds_data %>%
  filter(Sex == 'Male' | Sex == 'Female') %>%
  group_by(Sex, Month.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number)) 

Sex_all_mo_male <- pinnipeds_data %>%
  filter(Sex == 'Male') %>%
  group_by(Year.of.Observation, Month.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number)) 

Sex_all_mo_fem <- pinnipeds_data %>%
  filter(Sex == 'Female') %>%
  group_by(Year.of.Observation, Month.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number)) 

# <--- For females, July is different from Jan through May, whereas for males, July is different from only Jan, Feb (males stranding more in late spring, so broader peak?)
kruskal.test(Sex_all_mo_fem)
posthoc.kruskal.nemenyi.test(cnt ~ Month.of.Observation, Sex_all_mo_fem, dist = "Chisquare")

kruskal.test(Sex_all_mo_male)
posthoc.kruskal.nemenyi.test(cnt ~ Month.of.Observation, Sex_all_mo_male, dist = "Chisquare")


```

- Is there a difference in age class of strandings and HI cases?
```{r}
# Is there a difference in age class strandings/HI cases? 

#all strandings
age_all <- pinnipeds_data %>%
  group_by(Age.Class, Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number)) 

# <--- Yes, pups and adults (not different from each other) are different from subadults and yearlings (not different from each other). p < 0.05, difs amount to ~38 animals/yr
kruskal.test(age_all)
kruskalmc(age_all$cnt ~ age_all$Age.Class)
#posthoc.kruskal.nemenyi.test(cnt ~ Age.Class, age_all, dist = "Chisquare")

#HI strandings
age_HI <- pinnipeds_data %>%
  filter(Findings.of.Human.Interaction == 'Y') %>%
  group_by(Age.Class, Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number)) 

# <--- Yes, yearlings significantly different (lower). p < 0.05, difs amount to ~38 animals/yr
kruskal.test(age_HI)
kruskalmc(age_HI$cnt ~ age_HI$Age.Class)
#posthoc.kruskal.nemenyi.test(cnt ~ Age.Class, age_HI, dist = "Chisquare")

```

- Is there a difference between ages and sexes?
- Help: would like non-parametric test for multiple categorical variables? 
```{r }
#Differences between ages and sexes?  
age_sex_all <- pinnipeds_data %>%
  group_by(Sex, Age.Class, Year.of.Observation) %>%
  summarize(cnt = n_distinct(National.Database.Number))

#Need non-parametric version of this, for multiple comparisons :(  help
TukeyHSD(aov(cnt ~ Sex*Age.Class, data = age_sex_all))

# kruskalmc(age_sex_all$cnt ~ age_sex_all$Age.Class*age_sex_all$Sex)
# posthoc.kruskal.nemenyi.test(cnt ~ Age.Class + Sex, age_sex_all, dist = "Chisquare")

```



